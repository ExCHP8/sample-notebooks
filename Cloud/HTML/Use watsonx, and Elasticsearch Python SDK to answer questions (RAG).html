<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>c15dd56decb44fe7b48e01440ee763fb</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div class="cell markdown">
<p><img
src="https://raw.githubusercontent.com/IBM/watson-machine-learning-samples/master/cloud/notebooks/headers/watsonx-Prompt_Lab-Notebook.png"
alt="image" /></p>
<h1
id="use-watsonx-and-elasticsearch-python-sdk-to-answer-questions-rag">Use
watsonx, and Elasticsearch Python SDK to answer questions (RAG)</h1>
</div>
<div class="cell markdown">
<h4 id="disclaimers">Disclaimers</h4>
<ul>
<li>Use only Projects and Spaces that are available in watsonx
context.</li>
</ul>
<h2 id="notebook-content">Notebook content</h2>
<p>This notebook contains the steps and code to demonstrate support of
Retrieval Augumented Generation in watsonx.ai. It introduces commands
for data retrieval, knowledge base building &amp; querying, and model
testing.</p>
<p>Some familiarity with Python is helpful. This notebook uses Python
3.10.</p>
<h4 id="about-retrieval-augmented-generation">About Retrieval Augmented
Generation</h4>
<p>Retrieval Augmented Generation (RAG) is a versatile pattern that can
unlock a number of use cases requiring factual recall of information,
such as querying a knowledge base in natural language.</p>
<p>In its simplest form, RAG requires 3 steps:</p>
<ul>
<li>Index knowledge base passages (once)</li>
<li>Retrieve relevant passage(s) from knowledge base (for every user
query)</li>
<li>Generate a response by feeding retrieved passage into a large
language model (for every user query)</li>
</ul>
<h2 id="contents">Contents</h2>
<p>This notebook contains the following parts:</p>
<ul>
<li><a href="#setup">Setup</a></li>
<li><a href="#data">Data (test) loading</a></li>
<li><a href="#models">Foundation Models on watsonx</a></li>
<li><a href="#elastic_conn">Basic information how to connect to
Elasticsearch (applies to both scenarios)</a></li>
<li><strong><a href="#elastic">Retrieval augmented generation using
Elasticsearch (Python Client)</a></strong>
<ul>
<li><a href="#mapping">Create index</a></li>
<li><a href="#index_data">Index data into Elasticsearch</a></li>
<li><a href="#knn">Run semantic knn search queries</a></li>
<li><a href="#elastic_score">Calculate rougeL metric</a></li>
</ul></li>
</ul>
</div>
<div class="cell markdown">
<p><a id="setup"></a></p>
<h2 id="set-up-the-environment">Set up the environment</h2>
<p>Before you use the sample code in this notebook, you must perform the
following setup tasks:</p>
<ul>
<li>Create a
<a href="https://console.ng.bluemix.net/catalog/services/ibm-watson-machine-learning/" target="_blank" rel="noopener no referrer">Watson
Machine Learning (WML) Service</a> instance (a free plan is offered and
information about how to create the instance can be found
<a href="https://dataplatform.cloud.ibm.com/docs/content/wsj/analyze-data/ml-service-instance.html?context=analytics" target="_blank" rel="noopener no referrer">here</a>).</li>
</ul>
</div>
<section id="install-and-import-dependecies" class="cell markdown">
<h3>Install and import dependecies</h3>
</section>
<div class="cell code">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="st">&quot;langchain==0.0.340&quot;</span> <span class="op">|</span> tail <span class="op">-</span>n <span class="dv">1</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install elasticsearch <span class="op">|</span> tail <span class="op">-</span>n <span class="dv">1</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install sentence_transformers <span class="op">|</span> tail <span class="op">-</span>n <span class="dv">1</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install pandas <span class="op">|</span> tail <span class="op">-</span>n <span class="dv">1</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install rouge_score <span class="op">|</span> tail <span class="op">-</span>n <span class="dv">1</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install nltk <span class="op">|</span> tail <span class="op">-</span>n <span class="dv">1</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install wget <span class="op">|</span> tail <span class="op">-</span>n <span class="dv">1</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install evaluate <span class="op">|</span> tail <span class="op">-</span>n <span class="dv">1</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="st">&quot;pydantic==1.10.0&quot;</span> <span class="op">|</span> tail <span class="op">-</span>n <span class="dv">1</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="st">&quot;ibm-watson-machine-learning&gt;=1.0.312&quot;</span> <span class="op">|</span> tail <span class="op">-</span>n <span class="dv">1</span></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="3">
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os, getpass</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code></pre></div>
</div>
<section id="watsonx-api-connection" class="cell markdown">
<h3>watsonx API connection</h3>
<p>This cell defines the credentials required to work with watsonx API
for Foundation Model inferencing.</p>
<p><strong>Action:</strong> Provide the IBM Cloud user API key. For
details, see
<a href="https://cloud.ibm.com/docs/account?topic=account-userapikey&interface=ui" target="_blank" rel="noopener no referrer">documentation</a>.</p>
</section>
<div class="cell code" data-execution_count="4" data-scrolled="true">
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>credentials <span class="op">=</span> {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;url&quot;</span>: <span class="st">&quot;https://us-south.ml.cloud.ibm.com&quot;</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;apikey&quot;</span>: getpass.getpass(<span class="st">&quot;Please enter your WML api key (hit enter): &quot;</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<section id="defining-the-project-id" class="cell markdown">
<h3>Defining the project id</h3>
<p>The API requires project id that provides the context for the call.
We will obtain the id from the project in which this notebook runs.
Otherwise, please provide the project id.</p>
<p><strong>Hint</strong>: You can find the <code>project_id</code> as
follows. Open the prompt lab in watsonx.ai. At the very top of the UI,
there will be <code>Projects / &lt;project name&gt; /</code>. Click on
the <code>&lt;project name&gt;</code> link. Then get the
<code>project_id</code> from Project's Manage tab (Project -&gt; Manage
-&gt; General -&gt; Details).</p>
</section>
<div class="cell code" data-execution_count="5">
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    project_id <span class="op">=</span> os.environ[<span class="st">&quot;PROJECT_ID&quot;</span>]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    project_id <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;Please enter your project_id (hit enter): &quot;</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<p><a id="data"></a></p>
<h2 id="data-test-loading">Data (test) loading</h2>
</div>
<div class="cell markdown">
<p>Download the test dataset. This dataset is used to calculate the
metrics score for selected model, defined prompts and parameters.</p>
</div>
<div class="cell code" data-execution_count="6">
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> wget</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>questions_test_filename <span class="op">=</span> <span class="st">&#39;questions_test.csv&#39;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>questions_train_filename <span class="op">=</span> <span class="st">&#39;questions_train.csv&#39;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>questions_test_url <span class="op">=</span> <span class="st">&#39;https://raw.github.com/IBM/watson-machine-learning-samples/master/cloud/data/RAG/questions_test.csv&#39;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>questions_train_url <span class="op">=</span> <span class="st">&#39;https://raw.github.com/IBM/watson-machine-learning-samples/master/cloud/data/RAG/questions_train.csv&#39;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.isfile(questions_test_filename): </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    wget.download(questions_test_url, out<span class="op">=</span>questions_test_filename)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.isfile(questions_train_filename): </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    wget.download(questions_train_url, out<span class="op">=</span>questions_train_filename)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="7">
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>filename_test <span class="op">=</span> <span class="st">&#39;./questions_test.csv&#39;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>filename_train <span class="op">=</span>  <span class="st">&#39;./questions_train.csv&#39;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>test_data <span class="op">=</span> pd.read_csv(filename_test)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>train_data <span class="op">=</span> pd.read_csv(filename_train)</span></code></pre></div>
</div>
<div class="cell markdown">
<p>Inspect data sample</p>
</div>
<div class="cell code" data-execution_count="8">
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>train_data.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="8">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>qid</th>
      <th>question</th>
      <th>answers</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1961</td>
      <td>where does diffusion occur in the excretory sy...</td>
      <td>diffusion</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7528</td>
      <td>when did the us join world war one</td>
      <td>April 6 , 1917</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8685</td>
      <td>who played wilma in the movie the flintstones</td>
      <td>Elizabeth Perkins</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6716</td>
      <td>when was the office of the vice president created</td>
      <td>1787</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2916</td>
      <td>where does carbon fixation occur in c4 plants</td>
      <td>in the mesophyll cells</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="build-up-knowledge-base" class="cell markdown">
<h3>Build up knowledge base</h3>
<p>The current state-of-the-art in RAG is to create dense vector
representations of the knowledge base in order to calculate the semantic
similarity to a given user query.</p>
<p>We can generate dense vector representations using embedding models.
In this notebook, we use
<a href="https://www.sbert.net/" target="_blank" rel="noopener no referrer">SentenceTransformers</a>
<a href="https://huggingface.co/sentence-transformers/all-MiniLM-L6-v2" target="_blank" rel="noopener no referrer">all-MiniLM-L6-v2</a>
to embed both the knowledge base passages and user queries.
<code>all-MiniLM-L6-v2</code> is a performant open-source model that is
small enough to run locally.</p>
<p>A vector database is optimized for dense vector indexing and
retrieval. This notebook uses
<a href="https://python.langchain.com/docs/integrations/vectorstores/elasticsearch#basic-example" target="_blank" rel="noopener no referrer">Elasticsearch</a>,
a distributed, RESTful search and analytics engine, capable of
performing both vector and lexical search. It is built on top of the
Apache Lucene library, which offers good speed and performance with
all-MiniLM-L6-v2 embedding model.</p>
</section>
<div class="cell markdown">
<p>The dataset we are using is already split into self-contained
passages that can be ingested by Elasticsearch.</p>
<p>The size of each passage is limited by the embedding model's context
window (which is 256 tokens for <code>all-MiniLM-L6-v2</code>).</p>
</div>
<section id="load-knowledge-base-documents" class="cell markdown">
<h3>Load knowledge base documents</h3>
<p>Load set of documents used further to build knowledge base.</p>
</section>
<div class="cell code" data-execution_count="9">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>knowledge_base_dir <span class="op">=</span> <span class="st">&quot;./knowledge_base&quot;</span></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="10">
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>my_path <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>os<span class="sc">.</span>getcwd()<span class="sc">}</span><span class="ss">/knowledge_base&quot;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.isdir(my_path):</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>   os.makedirs(my_path)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="11">
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>documents_filename <span class="op">=</span> <span class="st">&#39;knowledge_base/psgs.tsv&#39;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>documents_url <span class="op">=</span> <span class="st">&#39;https://raw.github.com/IBM/watson-machine-learning-samples/master/cloud/data/RAG/psgs.tsv&#39;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.isfile(documents_filename): </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    wget.download(documents_url, out<span class="op">=</span>documents_filename)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="12">
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>documents <span class="op">=</span> pd.read_csv(<span class="ss">f&quot;</span><span class="sc">{</span>knowledge_base_dir<span class="sc">}</span><span class="ss">/psgs.tsv&quot;</span>, sep<span class="op">=</span><span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span>, header<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>documents[<span class="st">&#39;indextext&#39;</span>] <span class="op">=</span> documents[<span class="st">&#39;title&#39;</span>].astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> documents[<span class="st">&#39;text&#39;</span>]</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>documents <span class="op">=</span> documents[:<span class="dv">1000</span>]</span></code></pre></div>
</div>
<section id="create-an-embedding-function" class="cell markdown">
<h3>Create an embedding function</h3>
<p>Note that you can feed a custom embedding function to be used by
Elasticsearch. The performance of Elasticsearch may differ depending on
the embedding model used.</p>
</section>
<div class="cell code">
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> langchain.embeddings <span class="im">import</span> SentenceTransformerEmbeddings</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>emb_func <span class="op">=</span> SentenceTransformerEmbeddings(model_name<span class="op">=</span><span class="st">&quot;all-MiniLM-L6-v2&quot;</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<p><a id="models"></a></p>
<h2 id="foundation-models-on-watsonx">Foundation Models on watsonx</h2>
</div>
<section id="defining-model" class="cell markdown">
<h3>Defining model</h3>
<p>You need to specify <code>model_id</code> that will be used for
inferencing:</p>
</section>
<div class="cell code" data-execution_count="14">
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ibm_watson_machine_learning.foundation_models.utils.enums <span class="im">import</span> ModelTypes</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>model_id <span class="op">=</span> ModelTypes.FLAN_UL2</span></code></pre></div>
</div>
<section id="defining-the-model-parameters" class="cell markdown">
<h3>Defining the model parameters</h3>
<p>We need to provide a set of model parameters that will influence the
result:</p>
</section>
<div class="cell code" data-execution_count="15">
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ibm_watson_machine_learning.metanames <span class="im">import</span> GenTextParamsMetaNames <span class="im">as</span> GenParams</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ibm_watson_machine_learning.foundation_models.utils.enums <span class="im">import</span> DecodingMethods</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> {</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    GenParams.DECODING_METHOD: DecodingMethods.GREEDY,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    GenParams.MIN_NEW_TOKENS: <span class="dv">1</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    GenParams.MAX_NEW_TOKENS: <span class="dv">50</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<section id="initialize-the-model-class" class="cell markdown">
<h3>Initialize the <code>Model</code> class.</h3>
</section>
<div class="cell code" data-execution_count="16">
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ibm_watson_machine_learning.foundation_models <span class="im">import</span> Model</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Model(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    model_id<span class="op">=</span>model_id,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    params<span class="op">=</span>parameters,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    credentials<span class="op">=</span>credentials,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    project_id<span class="op">=</span>project_id</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div class="cell markdown">
<p><a id="elastic_conn"></a></p>
<h2 id="basic-information-how-to-connect-to-elasticsearch">Basic
information how to connect to Elasticsearch</h2>
<p><strong>This notebook focuses on self-managed cluster using
<a href="https://cloud.ibm.com/docs/databases-for-elasticsearch?topic=databases-for-elasticsearch-getting-started" target="_blank" rel="noopener no referrer">IBM
Cloud® Databases for Elasticsearch.</a></strong></p>
<p>The following cell retrieves the Elasticsearch users, password, host
and port from the environment if available and prompts you
otherwise.</p>
</div>
<div class="cell code">
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    esuser <span class="op">=</span> os.environ[<span class="st">&quot;ESUSER&quot;</span>]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    esuser <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;Please enter your Elasticsearch user name (hit enter): &quot;</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    espassword <span class="op">=</span> os.environ[<span class="st">&quot;ESPASSWORD&quot;</span>]</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    espassword <span class="op">=</span> getpass.getpass(<span class="st">&quot;Please enter your Elasticsearch password (hit enter): &quot;</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    eshost <span class="op">=</span> os.environ[<span class="st">&quot;ESHOST&quot;</span>]</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    eshost <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;Please enter your Elasticsearch hostname (hit enter): &quot;</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    esport <span class="op">=</span> os.environ[<span class="st">&quot;ESPORT&quot;</span>]</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    esport <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;Please enter your Elasticsearch port number (hit enter): &quot;</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<p>By default Elasticsearch will start with security features like
authentication and TLS enabled. To connect to the Elasticsearch cluster
you’ll need to configure the Python Elasticsearch client to use HTTPS
with the generated CA certificate in order to make requests
successfully. Details can be found
<a href="https://www.elastic.co/guide/en/elasticsearch/client/python-api/current/connecting.html#connect-self-managed-new" target="_blank" rel="noopener no referrer">here</a>.
In this notebook certificate fingerprints will be used for
authentication.</p>
<p><strong>Verifying HTTPS with certificate fingerprints (Python 3.10 or
later)</strong> If you don’t have access to the generated CA file from
Elasticsearch you can use the following script to output the root CA
fingerprint of the Elasticsearch instance with openssl s_client
<a href="https://www.elastic.co/guide/en/elasticsearch/client/python-api/current/connecting.html#_verifying_https_with_certificate_fingerprints_python_3_10_or_later" target="_blank" rel="noopener no referrer">
(docs)</a>:</p>
<p>The following cell retrieves the fingerprint information using a
shell command and stores it in variable
<code>ssl_assert_fingerprint</code>.</p>
</div>
<div class="cell code">
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>es_ssl_fingerprint <span class="op">=</span> <span class="op">!</span>openssl s_client <span class="op">-</span><span class="ex">connect</span> $eshost:$esport  <span class="op">-</span>showcerts <span class="op">&lt;/</span>dev<span class="op">/</span>null <span class="dv">2</span><span class="op">&gt;/</span>dev<span class="op">/</span>null <span class="op">|</span> openssl x509 <span class="op">-</span>fingerprint <span class="op">-</span>sha256 <span class="op">-</span>noout <span class="op">-</span><span class="kw">in</span> <span class="op">/</span>dev<span class="op">/</span>stdin</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>es_ssl_fingerprint <span class="op">=</span> es_ssl_fingerprint[<span class="dv">0</span>].split(<span class="st">&quot;=&quot;</span>)[<span class="dv">1</span>]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>es_ssl_fingerprint</span></code></pre></div>
</div>
<div class="cell markdown">
<p><a id="elastic"></a></p>
<h1
id="retrieval-augmented-generation-using-elasticsearch-python-sdk">Retrieval
augmented generation using Elasticsearch (Python SDK)</h1>
</div>
<div class="cell markdown">
<p>Connect to Elasticsearch</p>
</div>
<div class="cell code" data-execution_count="18">
<div class="sourceCode" id="cb18"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> elasticsearch <span class="im">import</span> Elasticsearch</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>elastic_client <span class="op">=</span> Elasticsearch([<span class="ss">f&quot;https://</span><span class="sc">{</span>esuser<span class="sc">}</span><span class="ss">:</span><span class="sc">{</span>espassword<span class="sc">}</span><span class="ss">@</span><span class="sc">{</span>eshost<span class="sc">}</span><span class="ss">:</span><span class="sc">{</span>esport<span class="sc">}</span><span class="ss">&quot;</span>],</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                              basic_auth<span class="op">=</span>(esuser, espassword),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                              request_timeout<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                              ssl_assert_fingerprint<span class="op">=</span>es_ssl_fingerprint)</span></code></pre></div>
</div>
<div class="cell markdown">
<p>In this scenario the same embedding function
<code>all-MiniLM-L6-v2</code> will be used.</p>
</div>
<div class="cell code" data-execution_count="20">
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>dims <span class="op">=</span> emb_func.client.get_sentence_embedding_dimension()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>dims</span></code></pre></div>
<div class="output execute_result" data-execution_count="20">
<pre><code>384</code></pre>
</div>
</div>
<div class="cell markdown">
<p><a id="mapping"></a></p>
<h3 id="create-index">Create index</h3>
<p>To create Elasticsearch index necessary mappings need to be created.
This will enable index the data into Elasticsearch.</p>
<p>Field <code>dense_vector</code> is a special type that allows to
store dense vectors in this case <code>embedding</code> in
Elasticsearch.</p>
</div>
<div class="cell code" data-execution_count="21">
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>index_name <span class="op">=</span> <span class="st">&quot;elastic_knn_index&quot;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>mapping <span class="op">=</span> {</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;properties&quot;</span>: {</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;text&quot;</span>: {</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;type&quot;</span>: <span class="st">&quot;text&quot;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>                    },</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;embedding&quot;</span>: {</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;type&quot;</span>: <span class="st">&quot;dense_vector&quot;</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;dims&quot;</span>: dims,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;index&quot;</span>: <span class="va">True</span>,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;similarity&quot;</span>: <span class="st">&quot;l2_norm&quot;</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="24">
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> elastic_client.indices.exists(index<span class="op">=</span>index_name):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    elastic_client.indices.delete(index<span class="op">=</span>index_name)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>elastic_client.indices.create(index<span class="op">=</span>index_name, mappings<span class="op">=</span>mapping)</span></code></pre></div>
<div class="output execute_result" data-execution_count="24">
<pre><code>ObjectApiResponse({&#39;acknowledged&#39;: True, &#39;shards_acknowledged&#39;: True, &#39;index&#39;: &#39;elastic_knn_index&#39;})</code></pre>
</div>
</div>
<div class="cell markdown">
<p><a id="index_data"></a></p>
<h3 id="index-data-into-elasticsearch">Index data into
Elasticsearch</h3>
<p>The following function generates the required bulk actions that can
be passed to Elasticsearch's Bulk API, so we can index multiple
documents efficiently. To perform semantic search, we need to encode
queries with the same embedding model used to encode the documents at
index time.</p>
</div>
<div class="cell code" data-execution_count="25">
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>texts <span class="op">=</span> documents.indextext.tolist()</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>embedded_docs <span class="op">=</span> emb_func.embed_documents(texts)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="26">
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> elasticsearch.helpers <span class="im">import</span> bulk</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>document_list <span class="op">=</span> []</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="dv">500</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>requests <span class="op">=</span> []</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (text, vector) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(texts, embedded_docs)):</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    document <span class="op">=</span> {<span class="st">&quot;_id&quot;</span>: i, <span class="st">&quot;embedding&quot;</span>: vector, <span class="st">&#39;text&#39;</span>: text}</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    document_list.append(document)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">%</span> batch_size <span class="op">==</span> batch_size<span class="op">-</span><span class="dv">1</span>:</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>        success, failed <span class="op">=</span> bulk(elastic_client, document_list, index<span class="op">=</span>index_name)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>        document_list <span class="op">=</span> []</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>elastic_client.indices.refresh(index<span class="op">=</span>index_name)</span></code></pre></div>
<div class="output execute_result" data-execution_count="26">
<pre><code>ObjectApiResponse({&#39;_shards&#39;: {&#39;total&#39;: 2, &#39;successful&#39;: 2, &#39;failed&#39;: 0}})</code></pre>
</div>
</div>
<section id="select-questions" class="cell markdown">
<h3>Select questions</h3>
<p>Get questions from the previously loaded test dataset.</p>
</section>
<div class="cell code" data-execution_count="57">
<div class="sourceCode" id="cb27"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>questions_and_answers <span class="op">=</span> [</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>            (<span class="st">&#39;names of founding fathers of the united states?&#39;</span>, <span class="st">&quot;Thomas Jefferson::James Madison::John Jay::George Washington::John Adams::Benjamin Franklin::Alexander Hamilton&quot;</span>),</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>            (<span class="st">&#39;who played in the super bowl in 2013?&#39;</span>, <span class="st">&#39;Baltimore Ravens::San Francisco 49ers&#39;</span>),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>            (<span class="st">&#39;when did bucharest become the capital of romania?&#39;</span>, <span class="st">&#39;1862&#39;</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>            ]</span></code></pre></div>
</div>
<div class="cell markdown">
<p><a id="knn"></a></p>
<h2 id="run-semantic-search-queries">Run semantic search queries</h2>
<p>Now it's time to run queries against our Elasticsearch index using
our encoded question. We'll be doing a k-nearest neighbors search, using
the Elasticsearch kNN query option. Argument k stands for a number of
nearest neighbors to return as top hits. Set minimal similarity score to
0.45</p>
</div>
<div class="cell code" data-execution_count="50">
<div class="sourceCode" id="cb28"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>relevant_contexts <span class="op">=</span> []</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> question_text, _ <span class="kw">in</span> questions_and_answers:</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    embedded_question <span class="op">=</span> emb_func.embed_query(question_text)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    relevant_chunks <span class="op">=</span> elastic_client.search(</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>          index<span class="op">=</span>index_name,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>          knn<span class="op">=</span>{</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;field&quot;</span>: <span class="st">&quot;embedding&quot;</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;query_vector&quot;</span>: embedded_question,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;k&quot;</span>: <span class="dv">4</span>,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;num_candidates&quot;</span>: <span class="dv">50</span>,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>          _source<span class="op">=</span>[</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;text&quot;</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>                  ],</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>          size<span class="op">=</span><span class="dv">5</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>                                </span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    relevant_contexts.append(relevant_chunks)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="51">
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>relevant_context <span class="op">=</span> relevant_contexts[<span class="dv">0</span>]</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>hits <span class="op">=</span> relevant_context[<span class="st">&#39;hits&#39;</span>][<span class="st">&#39;hits&#39;</span>]</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> hit <span class="kw">in</span> hits:</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;=========&quot;</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Paragraph index : &quot;</span>, hit[<span class="st">&quot;_id&quot;</span>])</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Paragraph : &quot;</span>, hit[<span class="st">&quot;_source&quot;</span>][<span class="st">&#39;text&#39;</span>])</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Distance : &quot;</span>,  hit[<span class="st">&quot;_score&quot;</span>])</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>            </span></code></pre></div>
<div class="output stream stdout">
<pre><code>=========
Paragraph index :  912
Paragraph :  Founding Fathers of the United States
^ Burstein , Andrew . `` Politics and Personalities : Garry Wills takes a new look at a forgotten founder , slavery and the shaping of America &#39;&#39; , Chicago Tribune ( November 09 , 2003 ) : `` Forgotten founders such as Pickering and Morris made as many waves as those whose faces stare out from our currency . &#39;&#39; ^ Jump up to : Rafael , Ray . The Complete Idiot &#39;s Guide to the Founding Fathers : And the Birth of Our Nation ( Penguin , 2011 ) . Jump up ^ `` Founding Fathers : Virginia &#39;&#39; . FindLaw Constitutional Law Center . 2008 . Retrieved 2008 - 11 - 14 . Jump up ^ Schwartz , Laurens R. Jews and the American Revolution : Haym Solomon and Others , Jefferson , North Carolina : McFarland &amp; Co. , 1987 . Jump up ^ Kendall , Joshua . The Forgotten Founding Father : Noah Webster &#39;s Obsession and the Creation of an American Culture ( Penguin 2011 ) . Jump up ^ Wright , R.E. ( 1996 ) . `` Thomas Willing ( 1731 - 1821 ) : Philadelphia Financier and Forgotten Founding Father &#39;&#39; . Pennsylvania History . 63 ( 4 ) : 525 -- 560 . doi : 10.2307 / 27773931 ( inactive 2017 - 01 - 15 ) . JSTOR 27773931 . Jump up ^ `` A Patriot of Early New England &#39;&#39; , New York Times ( December 20 , 1931 )
Distance :  0.6436015
=========
Paragraph index :  879
Paragraph :  Founding Fathers of the United States
Prior to , and during the 19th century , they were referred to as simply the `` Fathers &#39;&#39; . The term has been used to describe the founders and first settlers of the original royal colonies . Contents ( hide ) 1 Background 2 Interesting facts and commonalities 2.1 Education 2.1. 1 Colleges attended 2.1. 2 Advanced degrees and apprenticeships 2.1. 2.1 Doctors of medicine 2.1. 2.2 Theology 2.1. 2.3 Legal apprenticeships 2.1. 3 Self - taught or little formal education 2.2 Demographics 2.3 Political experience 2.4 Occupations and finances 2.5 Religion 2.6 Ownership of slaves and position on slavery 2.7 Attendance at conventions 2.8 Spouses and children 2.9 Charters of freedom and historical documents of the United States 2.10 Post-constitution life 2.11 Youth and longevity 2.12 Founders who were not signatories or delegates 3 Legacy 3.1 Institutions formed by Founders 3.2 Scholarship on the Founders 3.2. 1 Living historians whose focus is the Founding Fathers 3.2. 2 Noted collections of the Founding Fathers 3.3 In stage and film 3.4 Children &#39;s books 4 See also 5 Notes 6 References 7 External links Background ( edit ) The Albany Congress of 1754 was a conference attended by seven colonies , which presaged later efforts at cooperation . The Stamp Act Congress of 1765 included representatives from nine colonies . The First Continental Congress met briefly in Philadelphia , Pennsylvania in 1774 , consisting of fifty - six delegates from twelve of the thirteen colonies ( excluding Georgia ) that
Distance :  0.6386697
=========
Paragraph index :  939
Paragraph :  Founding Fathers of the United States
President of Congress Peyton Randolph New Hampshire John Sullivan Nathaniel Folsom Massachusetts Bay Thomas Cushing Samuel Adams John Adams Robert Treat Paine Rhode Island Stephen Hopkins Samuel Ward Connecticut Eliphalet Dyer Roger Sherman Silas Deane New York Isaac Low John Alsop John Jay James Duane Philip Livingston William Floyd Henry Wisner Simon Boerum New Jersey James Kinsey William Livingston Stephen Crane Richard Smith John De Hart Pennsylvania Joseph Galloway John Dickinson Charles Humphreys Thomas Mifflin Edward Biddle John Morton George Ross The Lower Counties Caesar Rodney Thomas McKean George Read Maryland Matthew Tilghman Thomas Johnson , Junr William Paca Samuel Chase Virginia Richard Henry Lee George Washington Patrick Henry , Junr Richard Bland Benjamin Harrison Edmund Pendleton North Carolina William Hooper Joseph Hewes Richard Caswell South Carolina Henry Middleton Thomas Lynch Christopher Gadsden John Rutledge Edward Rutledge See also Virginia Association First Continental Congress Carpenters &#39; Hall Declaration and Resolves of the First Continental Congress Retrieved from `` https://en.wikipedia.org/w/index.php?title=Founding_Fathers_of_the_United_States&amp;oldid=815247535 &#39;&#39; Categories : Age of Enlightenment American Revolution Articles about multiple people Patriots in the American Revolution Political leaders of the American Revolution National founders Hidden categories : Webarchive template wayback links Pages with DOIs inactive since 2017 Use mdy dates from April 2011 Talk Read Contents About Wikipedia Wikiquote Bân - lâm - gú Башҡортса Bikol Central Български Brezhoneg Català Čeština Cymraeg Deutsch Ελληνικά Español Esperanto فارسی Français 한국어 Հայերեն हिन्दी Ido Bahasa Indonesia Interlingua Íslenska Italiano עברית Latina Lietuvių Magyar Bahasa Melayu Nederlands 日本 語 Norsk Polski Português Română
Distance :  0.6376214
=========
Paragraph index :  877
Paragraph :  Founding Fathers of the United States
Founding Fathers of the United States - wikipedia Founding Fathers of the United States Jump to : navigation , search Declaration of Independence , a painting by John Trumbull depicting the Committee of Five presenting their draft to the Congress on June 28 , 1776 Signature page of Treaty of Paris ( 1783 ) ; the treaty was negotiated by John Adams , Benjamin Franklin and John Jay . The Founding Fathers of the United States were those individuals of the Thirteen Colonies in North America who led the American Revolution against the authority of the British Crown in word and deed and contributed to the establishment of the United States of America . Historian Richard B. Morris in 1973 identified the following seven figures as the key Founding Fathers : John Adams , Benjamin Franklin , Alexander Hamilton , John Jay , Thomas Jefferson , James Madison , and George Washington . Adams , Jefferson , and Franklin were members of the Committee of Five that drafted the Declaration of Independence . Hamilton , Madison , and Jay were authors of The Federalist Papers , advocating ratification of the Constitution . The constitutions drafted by Jay and Adams for their respective states of New York ( 1777 ) and Massachusetts ( 1780 ) were heavily relied upon when creating language for the US Constitution Jay , Adams and Franklin negotiated the Treaty of Paris ( 1783 ) that would end the American Revolutionary War . Washington was Commander -
Distance :  0.6280782
</code></pre>
</div>
</div>
<section id="feed-the-context-and-the-questions-to-watsonxai-model"
class="cell markdown">
<h3>Feed the context and the questions to <code>watsonx.ai</code>
model.</h3>
</section>
<div class="cell code" data-execution_count="52">
<div class="sourceCode" id="cb31"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_prompt(context, question_text):</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="ss">f&quot;Please answer the following.</span><span class="ch">\n</span><span class="ss">&quot;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>          <span class="op">+</span> <span class="ss">f&quot;</span><span class="sc">{</span>context<span class="sc">}</span><span class="ss">:</span><span class="ch">\n\n</span><span class="ss">&quot;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>          <span class="op">+</span> <span class="ss">f&quot;</span><span class="sc">{</span>question_text<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="58">
<div class="sourceCode" id="cb32"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>prompt_texts <span class="op">=</span> []</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> relevant_context, (question_text, _) <span class="kw">in</span> <span class="bu">zip</span>(relevant_contexts, questions_and_answers):</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    hits <span class="op">=</span> [hit <span class="cf">for</span> hit <span class="kw">in</span> relevant_context[<span class="st">&quot;hits&quot;</span>][<span class="st">&quot;hits&quot;</span>]]</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    context <span class="op">=</span> <span class="st">&quot;</span><span class="ch">\n\n\n</span><span class="st">&quot;</span>.join([rel_ctx[<span class="st">&quot;_source&quot;</span>][<span class="st">&#39;text&#39;</span>] <span class="cf">for</span> rel_ctx <span class="kw">in</span> hits])</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    prompt_text <span class="op">=</span> make_prompt(context, question_text)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    prompt_texts.append(prompt_text)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="54">
<div class="sourceCode" id="cb33"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(prompt_texts[<span class="dv">0</span>])</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Please answer the following.
Founding Fathers of the United States
^ Burstein , Andrew . `` Politics and Personalities : Garry Wills takes a new look at a forgotten founder , slavery and the shaping of America &#39;&#39; , Chicago Tribune ( November 09 , 2003 ) : `` Forgotten founders such as Pickering and Morris made as many waves as those whose faces stare out from our currency . &#39;&#39; ^ Jump up to : Rafael , Ray . The Complete Idiot &#39;s Guide to the Founding Fathers : And the Birth of Our Nation ( Penguin , 2011 ) . Jump up ^ `` Founding Fathers : Virginia &#39;&#39; . FindLaw Constitutional Law Center . 2008 . Retrieved 2008 - 11 - 14 . Jump up ^ Schwartz , Laurens R. Jews and the American Revolution : Haym Solomon and Others , Jefferson , North Carolina : McFarland &amp; Co. , 1987 . Jump up ^ Kendall , Joshua . The Forgotten Founding Father : Noah Webster &#39;s Obsession and the Creation of an American Culture ( Penguin 2011 ) . Jump up ^ Wright , R.E. ( 1996 ) . `` Thomas Willing ( 1731 - 1821 ) : Philadelphia Financier and Forgotten Founding Father &#39;&#39; . Pennsylvania History . 63 ( 4 ) : 525 -- 560 . doi : 10.2307 / 27773931 ( inactive 2017 - 01 - 15 ) . JSTOR 27773931 . Jump up ^ `` A Patriot of Early New England &#39;&#39; , New York Times ( December 20 , 1931 )


Founding Fathers of the United States
Prior to , and during the 19th century , they were referred to as simply the `` Fathers &#39;&#39; . The term has been used to describe the founders and first settlers of the original royal colonies . Contents ( hide ) 1 Background 2 Interesting facts and commonalities 2.1 Education 2.1. 1 Colleges attended 2.1. 2 Advanced degrees and apprenticeships 2.1. 2.1 Doctors of medicine 2.1. 2.2 Theology 2.1. 2.3 Legal apprenticeships 2.1. 3 Self - taught or little formal education 2.2 Demographics 2.3 Political experience 2.4 Occupations and finances 2.5 Religion 2.6 Ownership of slaves and position on slavery 2.7 Attendance at conventions 2.8 Spouses and children 2.9 Charters of freedom and historical documents of the United States 2.10 Post-constitution life 2.11 Youth and longevity 2.12 Founders who were not signatories or delegates 3 Legacy 3.1 Institutions formed by Founders 3.2 Scholarship on the Founders 3.2. 1 Living historians whose focus is the Founding Fathers 3.2. 2 Noted collections of the Founding Fathers 3.3 In stage and film 3.4 Children &#39;s books 4 See also 5 Notes 6 References 7 External links Background ( edit ) The Albany Congress of 1754 was a conference attended by seven colonies , which presaged later efforts at cooperation . The Stamp Act Congress of 1765 included representatives from nine colonies . The First Continental Congress met briefly in Philadelphia , Pennsylvania in 1774 , consisting of fifty - six delegates from twelve of the thirteen colonies ( excluding Georgia ) that


Founding Fathers of the United States
President of Congress Peyton Randolph New Hampshire John Sullivan Nathaniel Folsom Massachusetts Bay Thomas Cushing Samuel Adams John Adams Robert Treat Paine Rhode Island Stephen Hopkins Samuel Ward Connecticut Eliphalet Dyer Roger Sherman Silas Deane New York Isaac Low John Alsop John Jay James Duane Philip Livingston William Floyd Henry Wisner Simon Boerum New Jersey James Kinsey William Livingston Stephen Crane Richard Smith John De Hart Pennsylvania Joseph Galloway John Dickinson Charles Humphreys Thomas Mifflin Edward Biddle John Morton George Ross The Lower Counties Caesar Rodney Thomas McKean George Read Maryland Matthew Tilghman Thomas Johnson , Junr William Paca Samuel Chase Virginia Richard Henry Lee George Washington Patrick Henry , Junr Richard Bland Benjamin Harrison Edmund Pendleton North Carolina William Hooper Joseph Hewes Richard Caswell South Carolina Henry Middleton Thomas Lynch Christopher Gadsden John Rutledge Edward Rutledge See also Virginia Association First Continental Congress Carpenters &#39; Hall Declaration and Resolves of the First Continental Congress Retrieved from `` https://en.wikipedia.org/w/index.php?title=Founding_Fathers_of_the_United_States&amp;oldid=815247535 &#39;&#39; Categories : Age of Enlightenment American Revolution Articles about multiple people Patriots in the American Revolution Political leaders of the American Revolution National founders Hidden categories : Webarchive template wayback links Pages with DOIs inactive since 2017 Use mdy dates from April 2011 Talk Read Contents About Wikipedia Wikiquote Bân - lâm - gú Башҡортса Bikol Central Български Brezhoneg Català Čeština Cymraeg Deutsch Ελληνικά Español Esperanto فارسی Français 한국어 Հայերեն हिन्दी Ido Bahasa Indonesia Interlingua Íslenska Italiano עברית Latina Lietuvių Magyar Bahasa Melayu Nederlands 日本 語 Norsk Polski Português Română


Founding Fathers of the United States
Founding Fathers of the United States - wikipedia Founding Fathers of the United States Jump to : navigation , search Declaration of Independence , a painting by John Trumbull depicting the Committee of Five presenting their draft to the Congress on June 28 , 1776 Signature page of Treaty of Paris ( 1783 ) ; the treaty was negotiated by John Adams , Benjamin Franklin and John Jay . The Founding Fathers of the United States were those individuals of the Thirteen Colonies in North America who led the American Revolution against the authority of the British Crown in word and deed and contributed to the establishment of the United States of America . Historian Richard B. Morris in 1973 identified the following seven figures as the key Founding Fathers : John Adams , Benjamin Franklin , Alexander Hamilton , John Jay , Thomas Jefferson , James Madison , and George Washington . Adams , Jefferson , and Franklin were members of the Committee of Five that drafted the Declaration of Independence . Hamilton , Madison , and Jay were authors of The Federalist Papers , advocating ratification of the Constitution . The constitutions drafted by Jay and Adams for their respective states of New York ( 1777 ) and Massachusetts ( 1780 ) were heavily relied upon when creating language for the US Constitution Jay , Adams and Franklin negotiated the Treaty of Paris ( 1783 ) that would end the American Revolutionary War . Washington was Commander -:

what are the names of founding fathers of the united states?
</code></pre>
</div>
</div>
<section
id="generate-a-retrieval-augmented-response-with-watsonxai-model"
class="cell markdown">
<h3>Generate a retrieval-augmented response with watsonx.ai model</h3>
</section>
<div class="cell code" data-execution_count="59">
<div class="sourceCode" id="cb35"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> prompt_text <span class="kw">in</span> prompt_texts:</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    results.append(model.generate_text(prompt_text))</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="60">
<div class="sourceCode" id="cb36"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, result <span class="kw">in</span> <span class="bu">enumerate</span>(results):</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Question = &quot;</span>, questions_and_answers[idx][<span class="dv">0</span>])</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Answer = &quot;</span>, result)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Expected Answer(s) (may not be appear with exact wording in the dataset) = &quot;</span>,  questions_and_answers[idx][<span class="dv">1</span>])</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Question =  names of founding fathers of the united states?
Answer =  John Adams Benjamin Franklin Alexander Hamilton John Jay Thomas Jefferson James Madison George Washington
Expected Answer(s) (may not be appear with exact wording in the dataset) =  Thomas Jefferson::James Madison::John Jay::George Washington::John Adams::Benjamin Franklin::Alexander Hamilton


Question =  who played in the super bowl in 2013?
Answer =  Baltimore Ravens
Expected Answer(s) (may not be appear with exact wording in the dataset) =  Baltimore Ravens::San Francisco 49ers


Question =  when did bucharest become the capital of romania?
Answer =  1862
Expected Answer(s) (may not be appear with exact wording in the dataset) =  1862


</code></pre>
</div>
</div>
<div class="cell markdown">
<p><a id="score"></a></p>
<h2 id="calculate-rougel-metric">Calculate rougeL metric</h2>
<p>In this sample notebook <code>evaluate</code> module from HuggingFace
was used for rougeL calculation.</p>
</div>
<div class="cell code" data-execution_count="62">
<div class="sourceCode" id="cb38"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> evaluate <span class="im">import</span> load</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>rouge <span class="op">=</span> load(<span class="st">&#39;rouge&#39;</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> rouge.compute(predictions<span class="op">=</span>results, references<span class="op">=</span>[answer <span class="cf">for</span> _, answer <span class="kw">in</span> questions_and_answers])</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(scores)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>{&#39;rouge1&#39;: 0.8571428571428572, &#39;rouge2&#39;: 0.38974358974358975, &#39;rougeL&#39;: 0.6666666666666666, &#39;rougeLsum&#39;: 0.6666666666666666}
</code></pre>
</div>
</div>
<div class="cell markdown">
<hr />
</div>
<div class="cell markdown">
<p>Copyright © 2023 IBM. This notebook and its source code are released
under the terms of the MIT License.</p>
</div>
</body>
</html>
